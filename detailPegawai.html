<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Pegawai BPS - Unit Keuangan & SDM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bps-blue: #1a5cff;
            --bps-dark-blue: #134aad; /* Warna untuk header yang konsisten dengan dashboard */
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #111827;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { 
            background: var(--bg-color); 
            color: var(--text-color); 
            font-size: 15px; 
            min-height: 100vh;
        }

        /* --- Header Dashboard Style (Sudah Disesuaikan) --- */
        .header {
            background-color: var(--bps-dark-blue); 
            color: white;
            padding: 15px 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }
        
        /* --- Konten Utama --- */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 40px;
        }

        /* Tombol Kembali */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            margin-bottom: 25px;
            background: var(--card-bg);
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #e8f1ff;
            color: var(--bps-blue);
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }

        /* Sub-Header dan Kartu Status */
        .category-header { 
            font-size: 24px; 
            font-weight: 700; 
            margin-bottom: 20px; 
            color: var(--bps-blue); 
        }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .status-card:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .status-card.selected {
            border: 2px solid var(--bps-blue);
            background: #f1f6ff;
            box-shadow: 0 4px 15px rgba(26,92,255,0.2);
        }

        .status-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
        }

        .status-count {
            font-size: 32px;
            font-weight: 700;
            color: var(--bps-blue);
        }
        
        /* Area Daftar Nama Pegawai */
        .name-list-area {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
            min-height: 250px;
            border: 1px solid #e5e7eb;
        }

        .name-list-area h3 {
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 20px;
            font-weight: 700;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .name-list {
            list-style: none;
            padding: 0;
            columns: 2; 
            column-gap: 30px;
        }

        .name-list li {
            padding: 8px 0;
            border-bottom: 1px dashed #f3f4f6;
            font-size: 15px;
            color: #4b5563;
        }

        @media (max-width: 768px) {
            .header, .container { padding: 15px 20px; }
            .category-header { font-size: 20px; }
            .name-list { columns: 1; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1><span style="font-weight: 400;">Monitoring Pegawai</span> Unit Keuangan & SDM</h1>
    <div></div>
</div>

<div class="container">
    
    <a href="dashboard.html" class="back-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Kembali ke Dashboard
    </a>

    <h2 class="category-header">Detail Pegawai Berdasarkan Status</h2>
    
    <div class="status-cards" id="statusCards">
        </div>

    <div class="name-list-area">
        <h3 id="listHeader">Daftar Nama Pegawai</h3>
        <ul class="name-list" id="pegawaiList">
            <li>Memuat data...</li>
        </ul>
    </div>
</div>

<script>
    const TARGET_UNIT = "Keuangan & SDM";
    
    // Status yang digunakan untuk filter dan tampilan
    const statusCategories = [
        "CPNS",
        "PNS",
        "PPPK",
        "TB Dalam Negeri",
        "TB Luar Negeri"
    ];

    let filteredUnitPegawai = []; // Data pegawai yang sudah diproses
    let pegawaiCounts = {};
    
    // --- FUNGSI UTAMA: Mengambil dan Memproses Data dari LocalStorage ---
    function loadAndProcessData() {
        // Ambil data dari localStorage yang sama dengan yang digunakan di keuanganSdm.html
        const rawData = localStorage.getItem('sdmData');
        
        if (!rawData) {
            return [];
        }
        
        try {
            const data = JSON.parse(rawData);
            
            // Filter dan proses data untuk hanya mengambil 'nama' dan 'status'
            // Catatan: Karena data ini berasal dari satu halaman (keuanganSdm.html), 
            // kita asumsikan semua data yang dimuat adalah dari unit TARGET_UNIT.
            
            return data.map(item => ({
                nama: item.nama || 'Nama Tidak Diketahui',
                status: item.status || 'CPNS' // Default jika status kosong
            }));

        } catch (e) {
            console.error("Error parsing sdmData from localStorage:", e);
            return [];
        }
    }

    // --- FUNGSI UTILITAS ---

    function countPegawaiByStatus(data) {
        const counts = {};
        data.forEach(pegawai => {
            // Hanya hitung status yang ada di statusCategories
            if (statusCategories.includes(pegawai.status)) {
                 counts[pegawai.status] = (counts[pegawai.status] || 0) + 1;
            } else {
                 // Hitung status lain jika ada, atau abaikan jika tidak relevan
                 // Contoh: counts['Lainnya'] = (counts['Lainnya'] || 0) + 1;
            }
        });
        return counts;
    }

    function renderStatusCards(selectedStatus = null) {
        const cardsContainer = document.getElementById('statusCards');
        cardsContainer.innerHTML = ''; 

        // Cek jika data kosong
        if (filteredUnitPegawai.length === 0) {
            cardsContainer.innerHTML = `<p style="grid-column: 1 / -1; color: #ff3860; font-weight: 600;">⚠️ Tidak ada data pegawai ditemukan di Unit ${TARGET_UNIT}.</p>`;
            return;
        }

        statusCategories.forEach(status => {
            const count = pegawaiCounts[status] || 0;
            const isSelected = selectedStatus === status;
            
            const card = document.createElement('div');
            card.className = `status-card ${isSelected ? 'selected' : ''}`;
            // Pastikan kartu hanya dapat diklik jika jumlahnya > 0
            if (count > 0) {
                card.onclick = () => filterPegawai(status);
            } else {
                card.style.opacity = 0.6; // Visualisasi jika count 0
            }
            
            card.innerHTML = `
                <div class="status-name">${status}</div>
                <div class="status-count">${count}</div>
            `;
            cardsContainer.appendChild(card);
        });
    }

    function renderPegawaiList(data) {
        const listContainer = document.getElementById('pegawaiList');
        listContainer.innerHTML = '';

        if (data.length === 0) {
            listContainer.innerHTML = `<li>Tidak ada data pegawai ditemukan.</li>`;
            return;
        }

        data.forEach(pegawai => {
            const listItem = document.createElement('li');
            listItem.textContent = `${pegawai.nama} (${pegawai.status})`;
            listContainer.appendChild(listItem);
        });
    }

    function filterPegawai(status) {
        const listHeader = document.getElementById('listHeader');
        
        renderStatusCards(status);

        const filteredData = filteredUnitPegawai.filter(pegawai => pegawai.status === status);

        listHeader.textContent = `Daftar Nama Pegawai Status: ${status} | Unit ${TARGET_UNIT} (${filteredData.length} Orang)`;
        
        renderPegawaiList(filteredData);
    }
    
    // --- INISIALISASI ---
    function initializePage() {
        // Ambil data dari localStorage
        filteredUnitPegawai = loadAndProcessData();
        
        if (filteredUnitPegawai.length > 0) {
            pegawaiCounts = countPegawaiByStatus(filteredUnitPegawai);

            // Render kartu status
            renderStatusCards(null);

            // Tampilkan semua nama pegawai
            document.getElementById('listHeader').textContent = `Daftar Nama Pegawai (Total ${filteredUnitPegawai.length} Orang) di Unit ${TARGET_UNIT}`;
            renderPegawaiList(filteredUnitPegawai.sort((a, b) => a.nama.localeCompare(b.nama))); // Urutkan by nama
        } else {
             // Tampilkan pesan error jika data kosong
            document.getElementById('listHeader').textContent = `Daftar Nama Pegawai | Unit ${TARGET_UNIT}`;
            document.getElementById('pegawaiList').innerHTML = `<li>Data pegawai tidak ditemukan atau LocalStorage kosong. Pastikan Anda sudah mengimpor data di halaman Keuangan & SDM.</li>`;
            renderStatusCards(null); // Tampilkan kartu dengan angka 0
        }
    }

    window.onload = initializePage;
</script>

</body>
</html>